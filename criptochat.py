import rsa
import time
import os

def menu():
    print("MENÚ")
    print("---------------------------------------------------------------------------------------")
    print("1- Generar un nuevo par de claves pública-privada y registrarlo para el usuario del chat.")
    print("2- Registrar un par de claves pública-privada para el usuario del chat.")
    print("3- Registrar una clave pública para el destinatario de los mensajes.")
    print("4- Cifrar un mensaje con la clave pública registrada para el destinatario.")
    print("5- Descifrar un mensaje con la clave privada registrada para el usuario.")
    print("6- Cambiar el número de cifras de padding utilizadas por RSA.")
    print("7- Salir del programa.")
    print("---------------------------------------------------------------------------------------")
    try:
        op = int(input("Eliga una de las 7 opciones: "))
    except:
        raise error
    return op

if __name__ == '__main__':
    error = False
    continuar = True

    while continuar:
        try:
            op = menu()
            if op == 1:
                a = int(input("Introduzca un número: "))
                b = int(input("Introduzca otro número: "))
                claves = rsa.generar_claves(min(a,b), max(a,b))
                existe = os.path.exists("misclaves.txt")
                if existe:
                    print("Se van a generar unas claves público-privadas nuevas y se van a borrar las antiguas para el usuario")
                file = open("misclaves.txt", "w")
                file.write(str(claves[0]) + "\n")
                file.write(str(claves[1]) + "\n")
                file.write(str(claves[2]))
                file.close()
            elif op == 2:
                n = int(input("Introduzca el primer número de la clave pública (n): "))
                e = int(input("Introduzca el segundo número de la clave pública (e): "))
                d = int(input("Introduzca la clave privada (d): "))
                if existe:
                    print("Se van a registrar unas claves público-privadas nuevas y se van a borrar las antiguas para el usuario")
                file = open("misclaves.txt", "w")
                file.write(str(n) + "\n")
                file.write(str(e) + "\n")
                file.write(str(d))
                file.close()
            elif op == 3:
                claves = input("Introduzca la clave publica, los dos ")
                n = int(input("Introduzca la n: "))
                e = int(input("Introduzca la n: "))
                if existe:
                    print("Se van a registrar unas claves privadas nuevas y se van a borrar las antiguas para el destinatario")
                file = open("tusclaves.txt", "w")
                file.write(str(n) + "\n")
                file.write(str(e))
                file.close()
            elif op == 4:
                ...
            elif op == 5:
                ...
            elif op == 6:
                ...
            elif op == 7:
                continuar = False
            else:
                print("No ha introducido una opción válida")
        except:
            print("AA No ha introducido una opción válida")


    '''
    claves = rsa.generar_claves(16670,29860)
    print(claves)
    
    m = int(input("letra"))
    digitos_padding = 0
    c = rsa.cifrar_rsa(m,claves[0],claves[1],digitos_padding)
    
    print(rsa.descifrar_rsa(c,claves[0],claves[2],digitos_padding))

    cadena = "hola, me llamo"
    print(ord('h'))
    print(rsa.cifrar_rsa(ord('h'),claves[0],claves[1],0))
    cList = rsa.cifrar_cadena_rsa(cadena,claves[0],claves[1],0)
    print(cList)
    mensaje = rsa.descifrar_rsa(cList[0],claves[0],claves[2],0)
    print(rsa.ataque_texto_plano(cList,claves[0],claves[1]))
    

    i = time.time()
    n = 28282590191348679547
    e = 15780653617344828671
    mensaje = "9319749784910798525 4842569036581725503 20980190400660326533 6214149683214360481 4842569036581725503 20980190400660326533 2593648050233843527 6214149683214360481 28272142292129573062 18608120468201529368 12717565007171403561 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 2593648050233843527 18608120468201529368 20980190400660326533 2645277767775864437 18608120468201529368 4842569036581725503 15792170862416865726 2184632374345176968 18608120468201529368 22323999023705590489 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 15792170862416865726 6214149683214360481 19874418287555674497 14776330905304766194 20980190400660326533 4842569036581725503 14776330905304766194 14356227971113333857 1523370796302586613 12717565007171403561 22749440338291372804 20980190400660326533 4842569036581725503 14776330905304766194 20980190400660326533 28144107392132733343 6214149683214360481 25777023659433805948 22749440338291372804 12717565007171403561 14776330905304766194 20980190400660326533 18608120468201529368 15792170862416865726 14776330905304766194 12717565007171403561 21857556142816524701 18608120468201529368 12717565007171403561 14356227971113333857 22749440338291372804 22323999023705590489 20980190400660326533 4842569036581725503 14776330905304766194 20980190400660326533 2184632374345176968 18608120468201529368 20980190400660326533 14356227971113333857 6214149683214360481 15792170862416865726 2184632374345176968 14776330905304766194 20980190400660326533 27735342771309849241 25777023659433805948 22749440338291372804 14356227971113333857 20554480259726460599 14776330905304766194 20980190400660326533 28144107392132733343 6214149683214360481 22749440338291372804 20980190400660326533 9752506857902334135 25777023659433805948 9752506857902334135 7861010050314625994 18608120468201529368 20980190400660326533 6214149683214360481 4842569036581725503 20980190400660326533 2184632374345176968 25777023659433805948 21857556142816524701 18608120468201529368 2593648050233843527 28272142292129573062 14776330905304766194 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 2593648050233843527 14776330905304766194 1311789732010833948 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 2593648050233843527 18608120468201529368 4842569036581725503 19746169375983354497 18608120468201529368 20980190400660326533 22749440338291372804 4842569036581725503 20980190400660326533 18608120468201529368 1311789732010833948 27735342771309849241 25777023659433805948 2593648050233843527 2593648050233843527 22749440338291372804 12717565007171403561 14776330905304766194 22323999023705590489 20980190400660326533 18608120468201529368 21857556142816524701 18608120468201529368 12717565007171403561 28272142292129573062 18608120468201529368 20980190400660326533 18608120468201529368 4842569036581725503 27735342771309849241 25777023659433805948 28272142292129573062 6214149683214360481 18608120468201529368 22323999023705590489 20980190400660326533 12717565007171403561 14776330905304766194 15792170862416865726 7861010050314625994 4842569036581725503 20980190400660326533 14237643400138015579 2593648050233843527 18608120468201529368 15792170862416865726 14776330905304766194 20980190400660326533 19874418287555674497 20980190400660326533 28272142292129573062 18608120468201529368 2593648050233843527 28272142292129573062 14776330905304766194 20980190400660326533 15792170862416865726 14776330905304766194 12717565007171403561 12717565007171403561 22749440338291372804 21857556142816524701 14776330905304766194 12717565007171403561 12601521022934061392 20980190400660326533 21272876599726765219 4842569036581725503 18608120468201529368 20980190400660326533 14776330905304766194 2593648050233843527 2593648050233843527 18608120468201529368 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 18608120468201529368 2593648050233843527 28272142292129573062 14776330905304766194 20980190400660326533 14356227971113333857 10413804642095300346 1311789732010833948 20980190400660326533 9752506857902334135 18608120468201529368 15792170862416865726 18608120468201529368 20980190400660326533 28144107392132733343 6214149683214360481 22749440338291372804 20980190400660326533 15792170862416865726 18608120468201529368 12717565007171403561 4842569036581725503 22749440338291372804 12717565007171403561 14776330905304766194 22323999023705590489 20980190400660326533 1311789732010833948 18608120468201529368 2593648050233843527 20554480259726460599 25777023659433805948 15792170862416865726 6578013938662589726 4842569036581725503 20980190400660326533 2593648050233843527 18608120468201529368 1311789732010833948 20980190400660326533 14356227971113333857 10413804642095300346 1311789732010833948 20980190400660326533 4842569036581725503 14776330905304766194 15792170862416865726 2184632374345176968 22749440338291372804 1311789732010833948 22323999023705590489 20980190400660326533 21857556142816524701 6214149683214360481 22749440338291372804 2593648050233843527 14776330905304766194 1311789732010833948 20980190400660326533 19874418287555674497 20980190400660326533 28144107392132733343 6214149683214360481 22749440338291372804 1523370796302586613 12717565007171403561 18608120468201529368 4842569036581725503 27735342771309849241 14776330905304766194 1311789732010833948 20980190400660326533 2593648050233843527 14776330905304766194 1311789732010833948 20980190400660326533 1311789732010833948 10413804642095300346 1523370796302586613 18608120468201529368 21857556142816524701 14776330905304766194 1311789732010833948 22323999023705590489 20980190400660326533 2593648050233843527 18608120468201529368 4842569036581725503 27735342771309849241 22749440338291372804 26206620538814045720 18608120468201529368 1311789732010833948 20980190400660326533 2593648050233843527 14776330905304766194 1311789732010833948 20980190400660326533 9752506857902334135 25777023659433805948 22749440338291372804 12717565007171403561 4842569036581725503 22749440338291372804 1311789732010833948 22323999023705590489 20980190400660326533 18608120468201529368 2593648050233843527 28272142292129573062 14475833729579280389 4842569036581725503 20980190400660326533 20554480259726460599 18608120468201529368 2593648050233843527 14776330905304766194 14356227971113333857 25777023659433805948 4842569036581725503 14776330905304766194 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 18608120468201529368 6668148546026848177 18608120468201529368 21857556142816524701 25777023659433805948 21857556142816524701 6214149683214360481 12717565007171403561 18608120468201529368 20980190400660326533 2593648050233843527 14776330905304766194 1311789732010833948 20980190400660326533 21857556142816524701 14776330905304766194 14356227971113333857 25777023659433805948 4842569036581725503 28272142292129573062 14776330905304766194 1311789732010833948 22323999023705590489 20980190400660326533 15792170862416865726 14776330905304766194 4842569036581725503 1311789732010833948 6214149683214360481 14356227971113333857 7861010050314625994 18608120468201529368 4842569036581725503 20980190400660326533 2593648050233843527 18608120468201529368 1311789732010833948 20980190400660326533 27735342771309849241 12717565007171403561 22749440338291372804 1311789732010833948 20980190400660326533 20554480259726460599 18608120468201529368 12717565007171403561 27735342771309849241 22749440338291372804 1311789732010833948 20980190400660326533 21857556142816524701 22749440338291372804 20980190400660326533 1311789732010833948 6214149683214360481 20980190400660326533 2184632374345176968 18608120468201529368 15792170862416865726 25777023659433805948 22749440338291372804 4842569036581725503 21857556142816524701 18608120468201529368 12601521022934061392"
    cList =  mensaje.split(" ")
    print(rsa.ataque_texto_plano(cList,n,e))
    f  = time.time()
    print(f-i)
    '''